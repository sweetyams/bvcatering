!function(e){"function"==typeof define&&define.amd?define("picker",["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):this.Picker=e(jQuery)}(function($){function e(r,i,a,c){function u(){return e._.node("div",e._.node("div",e._.node("div",e._.node("div",k.component.nodes(h.open),y.box),y.wrap),y.frame),y.holder)}function f(){_.data(i,k).addClass(y.input).val(_.data("value")?k.get("select",v.format):r.value).on("focus."+h.id+" click."+h.id,m),v.editable||_.on("keydown."+h.id,function(e){var t=e.keyCode,n=/^(8|46)$/.test(t);return 27==t?(k.close(),!1):void((32==t||n||!h.open&&k.component.key[t])&&(e.preventDefault(),e.stopPropagation(),n?k.clear().close():k.open()))}),o(r,{haspopup:!0,expanded:!1,readonly:!1,owns:r.id+"_root"+(k._hidden?" "+k._hidden.id:"")})}function l(){k.$root.on({focusin:function(e){k.$root.removeClass(y.focused),e.stopPropagation()},"mousedown click":function(e){var t=e.target;t!=k.$root.children()[0]&&(e.stopPropagation(),"mousedown"!=e.type||$(t).is(":input")||"OPTION"==t.nodeName||(e.preventDefault(),r.focus()))}}).on("click","[data-pick], [data-nav], [data-clear], [data-close]",function(){var e=$(this),t=e.data(),n=e.hasClass(y.navDisabled)||e.hasClass(y.disabled),o=document.activeElement;o=o&&(o.type||o.href)&&o,(n||o&&!$.contains(k.$root[0],o))&&r.focus(),!n&&t.nav?k.set("highlight",k.component.item.highlight,{nav:t.nav}):!n&&"pick"in t?k.set("select",t.pick).close(!0):t.clear?k.clear().close(!0):t.close&&k.close(!0)}),o(k.$root[0],"hidden",!0)}function p(){var e;v.hiddenName===!0?(e=r.name,r.name=""):(e=["string"==typeof v.hiddenPrefix?v.hiddenPrefix:"","string"==typeof v.hiddenSuffix?v.hiddenSuffix:"_submit"],e=e[0]+r.name+e[1]),k._hidden=$('<input type=hidden name="'+e+'"'+(_.data("value")||r.value?' value="'+k.get("select",v.formatSubmit)+'"':"")+">")[0],_.on("change."+h.id,function(){k._hidden.value=r.value?k.get("select",v.formatSubmit):""}).after(k._hidden)}function m(e){e.stopPropagation(),"focus"==e.type&&k.$root.addClass(y.focused),k.open()}if(!r)return e;var g=!1,h={id:r.id||"P"+Math.abs(~~(Math.random()*new Date))},v=a?$.extend(!0,{},a.defaults,c):c||{},y=$.extend({},e.klasses(),v.klass),_=$(r),b=function(){return this.start()},k=b.prototype={constructor:b,$node:_,start:function(){return h&&h.start?k:(h.methods={},h.start=!0,h.open=!1,h.type=r.type,r.autofocus=r==document.activeElement,r.readOnly=!v.editable,r.id=r.id||h.id,"text"!=r.type&&(r.type="text"),k.component=new a(k,v),k.$root=$(e._.node("div",u(),y.picker,'id="'+r.id+'_root"')),l(),v.formatSubmit&&p(),f(),v.container?$(v.container).append(k.$root):_.after(k.$root),k.on({start:k.component.onStart,render:k.component.onRender,stop:k.component.onStop,open:k.component.onOpen,close:k.component.onClose,set:k.component.onSet}).on({start:v.onStart,render:v.onRender,stop:v.onStop,open:v.onOpen,close:v.onClose,set:v.onSet}),g=t(k.$root.children()[0]),r.autofocus&&k.open(),k.trigger("start").trigger("render"))},render:function(e){return e?k.$root.html(u()):k.$root.find("."+y.box).html(k.component.nodes(h.open)),k.trigger("render")},stop:function(){return h.start?(k.close(),k._hidden&&k._hidden.parentNode.removeChild(k._hidden),k.$root.remove(),_.removeClass(y.input).removeData(i),setTimeout(function(){_.off("."+h.id)},0),r.type=h.type,r.readOnly=!1,k.trigger("stop"),h.methods={},h.start=!1,k):k},open:function(t){return h.open?k:(_.addClass(y.active),o(r,"expanded",!0),setTimeout(function(){k.$root.addClass(y.opened),o(k.$root[0],"hidden",!1)},0),t!==!1&&(h.open=!0,g&&s.css("overflow","hidden").css("padding-right","+="+n()),_.trigger("focus"),d.on("click."+h.id+" focusin."+h.id,function(e){var t=e.target;t!=r&&t!=document&&3!=e.which&&k.close(t===k.$root.children()[0])}).on("keydown."+h.id,function(t){var n=t.keyCode,o=k.component.key[n],i=t.target;27==n?k.close(!0):i!=r||!o&&13!=n?$.contains(k.$root[0],i)&&13==n&&(t.preventDefault(),i.click()):(t.preventDefault(),o?e._.trigger(k.component.key.go,k,[e._.trigger(o)]):k.$root.find("."+y.highlighted).hasClass(y.disabled)||k.set("select",k.component.item.highlight).close())})),k.trigger("open"))},close:function(e){return e&&(_.off("focus."+h.id).trigger("focus"),setTimeout(function(){_.on("focus."+h.id,m)},0)),_.removeClass(y.active),o(r,"expanded",!1),setTimeout(function(){k.$root.removeClass(y.opened+" "+y.focused),o(k.$root[0],"hidden",!0)},0),h.open?(h.open=!1,g&&s.css("overflow","").css("padding-right","-="+n()),d.off("."+h.id),k.trigger("close")):k},clear:function(e){return k.set("clear",null,e)},set:function(e,t,n){var o,r,i=$.isPlainObject(e),a=i?e:{};if(n=i&&$.isPlainObject(t)?t:n||{},e){i||(a[e]=t);for(o in a)r=a[o],o in k.component.item&&(void 0===r&&(r=null),k.component.set(o,r,n)),("select"==o||"clear"==o)&&_.val("clear"==o?"":k.get(o,v.format)).trigger("change");k.render()}return n.muted?k:k.trigger("set",a)},get:function(t,n){if(t=t||"value",null!=h[t])return h[t];if("value"==t)return r.value;if(t in k.component.item){if("string"==typeof n){var o=k.component.get(t);return o?e._.trigger(k.component.formats.toString,k.component,[n,o]):""}return k.component.get(t)}},on:function(e,t,n){var o,r,i=$.isPlainObject(e),a=i?e:{};if(e){i||(a[e]=t);for(o in a)r=a[o],n&&(o="_"+o),h.methods[o]=h.methods[o]||[],h.methods[o].push(r)}return k},off:function(){var e,t,n=arguments;for(e=0,namesCount=n.length;namesCount>e;e+=1)t=n[e],t in h.methods&&delete h.methods[t];return k},trigger:function(t,n){var o=function(t){var o=h.methods[t];o&&o.map(function(t){e._.trigger(t,k,[n])})};return o("_"+t),o(t),k}};return new b}function t(e){var t,n="position";return e.currentStyle?t=e.currentStyle[n]:window.getComputedStyle&&(t=getComputedStyle(e)[n]),"fixed"==t}function n(){if(s.height()<=a.height())return 0;var e=$('<div style="visibility:hidden;width:100px" />').appendTo("body"),t=e[0].offsetWidth;e.css("overflow","scroll");var n=$('<div style="width:100%" />').appendTo(e),o=n[0].offsetWidth;return e.remove(),t-o}function o(e,t,n){if($.isPlainObject(t))for(var o in t)r(e,o,t[o]);else r(e,t,n)}function r(e,t,n){e.setAttribute(("role"==t?"":"aria-")+t,n)}function i(e,t){$.isPlainObject(e)||(e={attribute:t}),t="";for(var n in e){var o=("role"==n?"":"aria-")+n,r=e[n];t+=null==r?"":o+'="'+e[n]+'"'}return t}var a=$(window),d=$(document),s=$(document.documentElement);return e.klasses=function(e){return e=e||"picker",{picker:e,opened:e+"--opened",focused:e+"--focused",input:e+"__input",active:e+"__input--active",holder:e+"__holder",frame:e+"__frame",wrap:e+"__wrap",box:e+"__box"}},e._={group:function(t){for(var n,o="",r=e._.trigger(t.min,t);r<=e._.trigger(t.max,t,[r]);r+=t.i)n=e._.trigger(t.item,t,[r]),o+=e._.node(t.node,n[0],n[1],n[2]);return o},node:function(e,t,n,o){return t?(t=$.isArray(t)?t.join(""):t,n=n?' class="'+n+'"':"",o=o?" "+o:"","<"+e+n+o+">"+t+"</"+e+">"):""},lead:function(e){return(10>e?"0":"")+e},trigger:function(e,t,n){return"function"==typeof e?e.apply(t,n||[]):e},digits:function(e){return/\d/.test(e[1])?2:1},isDate:function(e){return{}.toString.call(e).indexOf("Date")>-1&&this.isInteger(e.getUTCDate())},isInteger:function(e){return{}.toString.call(e).indexOf("Number")>-1&&e%1===0},ariaAttr:i},e.extend=function(t,n){$.fn[t]=function(o,r){var i=this.data(t);return"picker"==o?i:i&&"string"==typeof o?e._.trigger(i[o],i,[r]):this.each(function(){var r=$(this);r.data(t)||new e(this,t,n,o)})},$.fn[t].defaults=n.defaults},e});